---
layout: post
title: Why I Still Love CQRS (and Messaging and Event Sourcing)
date: '2011-05-15T14:59:00.001+01:00'
author: solrevdev
tags: 
modified_time: '2011-05-15T14:59:04.227+01:00'
blogger_id: tag:blogger.com,1999:blog-31446756.post-7086701149785676997
blogger_orig_url: http://www.solrevdev.com/2011/05/why-i-still-love-cqrs-and-messaging-and.html
---

<div class='posterous_autopost'><div class="posterous_bookmarklet_entry"> <blockquote><div>  <p align="justify">Let’s rewind several years.&nbsp; At the time I was struggling through a large project with ever increasing complexity in my “domain model” (if you could really call it that) along with an explosion of dependencies—from NHibernate (including Fluent NHibernate, NHibernate.LINQ), log4net, unit tests, and web services all over the place.&nbsp; It was crazy—crazy big, crazy hard to debug, and crazy hard to figure out what was happening through the rats nest of dependencies.&nbsp; And this wasn’t even legacy code—we were in the middle of the project.&nbsp; Crazy.&nbsp; We were fighting an uphill battle and in a very real danger of losing despite us being a bunch of really smart guys.</p>  <p align="justify">Then I discovered <a href="http://martinfowler.com/eaaDev/EventSourcing.html">event sourcing</a> and it was as if a light went on.&nbsp; I could literally see how adoption of event sourcing could shed a massive amount of incidental and technical complexity from my project.&nbsp; Remember that at this point in time there was no CQRS—it hadn’t been officially defined.&nbsp; Nor had the term “event sourcing” really been refined according to Greg Young’s definition, as compared with <a href="http://martinfowler.com/eaaDev/EventSourcing.html">Martin Fowler’s</a>.&nbsp; Eric Evans had not yet done his presentation on what <a href="http://www.infoq.com/presentations/ddd-eric-evans">he learned since the book</a>.&nbsp; All I could find were a few small videos of Greg talking about events and how powerful they were.&nbsp; I started blogging like crazy—<a href="http://blog.jonathanoliver.com/archives/">perhaps about 20 posts or so</a>—on “DDDD” or “Distributed Domain-Driven Design” as Greg called it.&nbsp; The primary reason was I wanted to capture what I was learning, or at least my incomplete understanding of it.</p>  <p align="justify">Fast forward to today.&nbsp; I’ve now have a number of systems in production with several more that are only weeks away and I literally could not be happier.&nbsp; I have significantly more confidence in my software than I had in the past.&nbsp; The code is dramatically cleaner and infinitely more explicit than it would have been otherwise.&nbsp; But that’s only the starting point.&nbsp; Our ability to expand, adapt, and scale—to be agile from a business perspective—is infinitely greater than it ever has been, even with each application being significantly larger and each associated domain exponentially more complex than before—all with a smaller team.&nbsp; Why?</p>  <p align="justify">Among the most important factors are (not necessarily in order):</p>  <ol>  <li>    </li>  <li>    </li>  <li>    </li>  </ol>  <p align="justify"><strong>CQRS</strong></p>  <p align="justify">Because CQRS is now an overloaded term, we should take a moment to properly define it according to its <a href="http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/">official definition</a>:</p>  <blockquote><p align="justify">CQRS is simply the creation of two objects where there was previously only one. The separation occurs based upon whether the methods are a command or a query.</p>  </blockquote>  <p align="justify">Although there has been a <a href="http://groups.google.com/group/dddcqrs/msg/9126b6bc1c593897">small disagreement</a> of late between the co-authors of the CQRS pattern and its <a href="http://www.udidahan.com/2011/04/22/when-to-avoid-cqrs/">typical usage</a>, I’m choosing to define it according to Greg’s terms because he was the first to really bring this concept out and talk about it.</p>  <p align="justify">For me, CQRS (according to its official definition) brings one very significant and critical benefit to the table—that of making it so that each object has a single responsibility.&nbsp; No longer do I have massive domain aggregates that have a mountain of nested properties, e.g. Users[1].Orders[2].OrderLines[3].Product.Prices.PriceHistory[4].Amount.&nbsp; That kind of complexity just screams at you such that you can’t get anything else done.&nbsp; By introducing CQRS all of that went away and all of a sudden the domain code only contained domain complexity instead of accidental and technical complexity.</p>  <p align="justify">Reads were far easier too.&nbsp; Now I could have a simple object (or read/view model) that was purely focused on the needs of the UI.&nbsp; I can’t tell you how many times prior to this pattern I would have to hack my domain object model to accommodate the needs of a particular screen—especially when business pranced in the door and said, we need to display this value here.&nbsp; Then I’d go modify the database, modify the domain object, it associated DTOs, all of the mapping code, HTML, etc.&nbsp; Yuck.&nbsp; Now all of my getters and setters on the domain are gone and my views are targeted to the needs of the screen in question.&nbsp; Beautiful.&nbsp; Simple.</p>  <p align="justify"><strong>Event Sourcing</strong></p>  <p align="justify">Having experienced event sourcing and the need it fills, I’ll be hard pressed to give it up—not because it’s a panacea or a silver bullet—but because storage is cheap and data is valuable.&nbsp; As of about 3+ years ago, my specialty was temporal databases—storing a series of changes to data and *how* it changed across time in such a way that it could be queried and interpreted by the application.&nbsp; The schemas for those databases were so incredibly nasty that it made NHibernate look like “Hello, World!”—no joke.&nbsp; Although I could see when and how data changed, I still couldn’t see why.&nbsp; Event sourcing solves that problem.</p>  <p align="justify">With event sourcing I know exactly when, how, and most importantly why the data changed.&nbsp; Not only that, I can now build new and interesting reports from the data that we never knew we needed previously.&nbsp; For example, it would be trivial to find out how long it took for the average user to re-add a particular item to their shopping cart after it had been removed an a coupon code had been emailed.&nbsp; How could we have known to plan for that kind of report?&nbsp; But with event sourcing, it’s just a matter of writing a few message handlers, iterating through the event store, and pushing it into the handlers.</p>  <p align="justify">Not all of my code uses event sourcing—for example, trivial systems with little to know competitive value can be put together using whatever pattern we see fit.&nbsp; But for us, the systems that bring us competitive advantage always use event sourcing.</p>  <p align="justify"><strong>Messaging</strong></p>  <p align="justify">I do have to say that messaging has had by far the largest impact on the software I’ve written, more so than anything else.&nbsp; There are a number of significant reasons for this, but perhaps the most important one actually recaptures the essence of CQRS—that of having a single responsibility.&nbsp; By breaking the system apart into various pieces such that each can focus on a particular area of concern, we can more easily make better technology and implementation choices.&nbsp; For example, all of a sudden our website doesn’t have to be written in C#.&nbsp; Instead, we could leverage some open source CMS and expose simple JSON endpoints on the server that would receive RPC calls from the browser and then asynchronously dispatch messages for processing.&nbsp; Furthermore we are now able to evaluate storage engines based upon their technical merits and applicability to the problems at hand for a particular endpoint and business need.</p>  <p align="justify">The bottom line for messaging is about choice—we can now make well-informed choices at each messaging endpoint and select a piece of technology not on marketing and hype, but upon its ability to solve the problems at hand in a simple and elegant manner.</p>  <p align="justify"><strong>Conclusion</strong></p>  <p align="justify">I have found each of these patterns to be extremely valuable.&nbsp; Each has vastly simplified my code.&nbsp; The primary reason that I can see for developers to dismiss these patterns for their “increased complexity” is familiarity.&nbsp; In many ways we have been burned so often by some new technology that is going to save the world only to have it fall short.&nbsp; We have invested mountains of time in learning a new technology only to find support pulled for the product or to have some other piece of technology strike our fancy.&nbsp; After far too many cycles of this, it’s no wonder that there are so many skeptics among us.</p>  <p align="justify">The establishment has long pushed us in this direction claiming that technology alone can solve problems—usually a technology that they sell.&nbsp; The establishment is wrong.&nbsp; <strong>These patterns work because they transcend technology.&nbsp; They make it so that technology and software serves us, not the reverse.&nbsp; In short, by understanding and appropriately leveraging these patterns, life is good.&nbsp; Very, very good.</strong></p>  </div></blockquote>    <div class="posterous_quote_citation">via <a href="http://blog.jonathanoliver.com/2011/05/why-i-still-love-cqrs-and-messaging-and-event-sourcing/?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+joliver+%28Jonathan+Oliver%29">blog.jonathanoliver.com</a></div> <p>Still trying to get my head around CQRS. One day I'm just going to have to build something it along with messaging so it sticks in my head or I have a simple sample to keep looking back on.</p></div> <p style="font-size: 10px;"> <a href="http://posterous.com">Posted via email</a>  from <a href="http://solrev.posterous.com/why-i-still-love-cqrs-and-messaging-and-event">solution revolution</a> </p> </div>