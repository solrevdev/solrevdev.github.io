---
layout: post
title: 'AWS Cost Saving Tip 12: Add Spot Instances with Amazon EMR [feedly]'
date: '2013-06-30T16:15:00.000+01:00'
author: John Smith
tags: 
modified_time: '2013-06-30T16:21:11.181+01:00'
thumbnail: http://3.bp.blogspot.com/-V2lMBpvwXEc/UdBD2kXCPcI/AAAAAAAAA_Q/a0-z9SbE3Do/s72-c/Amazon+EMR+with+Spot+matrix.jpg
blogger_id: tag:blogger.com,1999:blog-31446756.post-4518744099100733709
blogger_orig_url: http://www.solrevdev.com/2013/06/aws-cost-saving-tip-12-add-spot.html
---

<div>      <style>  BODY  {  margin:1em;  font-size: 16px;  background-repeat: repeat;  line-height: 1.5em;  color: #262626;  }  a  {  color: #82BD1A;  }  table { font: inherit; }  .source {  color : #909090;  font-size : 14px;  }  .article  {  padding : 1em;  background-color: #eaeded;  color : #404040;  margin-top : 1.5em;  }  .visit  {  border-radius : 4px;  background-color: #CFCFCF;  text-align : center;  padding : 8px;  }  .visit a  {  text-decoration : none;  color : #666;  }  .header   {  padding-top : 0.3em;  padding-bottom : 1.5em;  font-size : 28px;  line-height : 1.2em;  font-weight : bold;  }  .footer   {  padding-top : 3em;  padding-bottom : 6em;  color : #444444;  text-align : center;  }  </style>      Now this looks very promising. background processing is something that I don't want to spend a penny more than is needed and certain parts of the infrastructure fit this use case quite nicely.&nbsp;</div><div><br></div><div>Keeping cloud computing costs low while delivering the best performance is a key part to my role and any article or tip around this area is always welcome.&nbsp;</div><div><br></div><div>This feed is becoming very useful to me indeed!<br>  &nbsp;  <br>  &nbsp;  <div class="article">  <div class="source">  Shared via <a href="http://bit.ly/SA6Efh">feedly</a> // published on Cloud, Big Data and Mobile // <a href="http://feedproxy.google.com/~r/CloudBigDataAndMobile/~3/2Qr94tWuyCs/Amazon-Web-Services-AWS-Cost-Saving-Tips-Adding-Spot-EC2-with-Amazon-Elastic-MapReduce-EMR.html">visit site</a>  </div>  <div class="header">  <b>AWS Cost Saving Tip 12: Add Spot Instances with Amazon EMR</b>  </div>  <div>  <span>In continuation to my post on <i><u><b><a href="http://harish11g.blogspot.in/2013/06/Amazon-Web-Services-AWS-Cost-Saving-Tips-elasticity-Amazon-Elastic-MapReduce-EMR.html">"How elastic thinking can save costs on Amazon EMR cluster ?"</a></b></u></i> i have explored in this post how we can exploit Amazon EMR by introducing Spot EC2 into the cluster and achieve more cost savings.</span><br>  <span><br></span>  <span>Most of us know that Amazon Spot EC2 instances are usually good choice for&nbsp;Time-flexible and interruption-tolerant tasks. These instances gets traded frequently on a Spot market price and you can fix your Bid Price using AWS API's or AWS Console. Once free Spot EC2 instances are available for your Bid Price, AWS will allot them for use in your account. Spot instances are usually available way cheaper than On-Demand EC2 instances most of the times. Example: On-Demand m1.xlarge per hour price is 0.48 USD and on spot market you can find them sometimes @ 0.052 per hour. This is ~9 times cheaper than the on-demand price; imagine if you can bid&nbsp;competitively&nbsp;and get hold of spot EC2 even around 0.24 USD most of the times, you are saving 50% from the on-demand price straight away. In Big data use cases usually you might need lots of EC2 nodes for processing, adopting such techniques can vastly make difference in your infra cost and operations in long term. I am sharing my experience on this subject as tips and techniques you can adopt to save costs while using EMR clusters in Amazon for big data problems.&nbsp;</span><br>  <i>Note : While dealing with spot you can be sure that you will never pay more than your maximum bid price per hour. </i><br>  <br>  <span>To know more about real implementation of these tips, read the following case study.&nbsp;<b><u><a href="http://harish11g.blogspot.in/2013/06/Amazon-Elastic-MapReduce-EMR-with-Spot-EC2-Cloud-Connect-Bigdata-presentation.html">Lock, Stock and X Smoking EC2's.</a></u></b>&nbsp;</span><br>  <div>  <span><br></span></div>  <span><b>Tip 1: Make right choice (Spot vs On-Demand) for the cluster components</b></span><br>  <span><u>Data Critical workloads:</u> For workloads which cannot afford to lose data you can have the Master + Core on Amazon On-Demand EC2 and your task nodes on Spot EC2. This is the most common pattern while combining Spot and On-Demand on Amazon EMR cluster. Since task nodes are operating on spot prices depending upon your bidding strategy you can save ~50% costs from running your task nodes using On-Demand EC2. You can further save</span><span>(if you are lucky)</span><span>&nbsp;by reserving your Core and Master Nodes , but you will be tied to an AZ. According to me this is not a good or common technique, because some AZ's can be very noisy with high spot prices. </span><br>  <span><u>Cost Driven workloads:</u>&nbsp;</span><span>When solving big data problems, sometimes you might have to face scenarios where cost is very important than time. Example: You are processing archives of old logs as low priority jobs, where cost of processing is very important and usually with abundant time left. Such cases you can have all the Master+Core+Task run on Spot EC2 to get further savings from the data critical workloads approach.&nbsp;</span><span>Since all the nodes are operating on spot prices depending upon your bidding strategy you can save ~60% or more costs from running your nodes using On-Demand EC2.&nbsp;</span><span>The below mentioned table published by AWS gives an indication of the Amazon EMR + Spot combinations that are widely used:</span><br>  <div>  <a href="http://3.bp.blogspot.com/-V2lMBpvwXEc/UdBD2kXCPcI/AAAAAAAAA_Q/a0-z9SbE3Do/s672/Amazon+EMR+with+Spot+matrix.jpg"><img border="0" width="640" src="http://3.bp.blogspot.com/-V2lMBpvwXEc/UdBD2kXCPcI/AAAAAAAAA_Q/a0-z9SbE3Do/s640/Amazon+EMR+with+Spot+matrix.jpg" height="294"></a></div>  <b>Tip 2: There is free lunch sometimes</b><br>  <span>Spot Instances can be interrupted by AWS when the spot price reaches your bidding price. What interruption means is that, AWS can pull out the Spot EC2's assigned to your account when the price matches/exceeds. If your Spot Task Nodes are interrupted you will not be charged for any partial hour of usage by AWS i.e. if you have started the instance @ 10:05 am and if your instances are interrupted by spot price fluctuations @ 10:45 am you will not be charged for the partial hour of usage. If your processing exercise is totally time insensitive, you can keep your bidding price at closer level to spot price which are easily interrupt-able by AWS and exploit this partial hours concept. Theoretically you can get most of the processing done through your task nodes for <b><span>free*</span></b> exploiting this strategy.</span><br>  <span><br></span>  <span><b>Tip 3: Use the AZ wisely when it comes to spot</b></span><br>  <span>Different AZ's inside an Amazon EC2 region has different spot prices for the same Instance type. Observe this pattern for a while, build some intelligence around the price data collected and rebuild your cluster in the AZ with lowest price. Since the Master+Core+Task need to run on the same AZ for better latency, it is advisable to architect your EMR clusters in such a way they can be switched(i.e.recreate) to different AZ's according to spot prices. If you can build this flexibility in your&nbsp;architecture you can save costs by leveraging the Inter AZ price fluctuations.&nbsp;</span><span>Refer the below images for Spot Price variations in 2 AZ's inside the same Region for same time period. <i>"Make your choice wisely time to time"</i></span><br>  <br>  <div>  <a href="http://4.bp.blogspot.com/-JqFY4PaP778/UdA7eXaGYhI/AAAAAAAAA-8/oZUS1P2Ofog/s1301/Amazon+Spot+price+AZ+-1.jpg"><img border="0" width="640" src="http://4.bp.blogspot.com/-JqFY4PaP778/UdA7eXaGYhI/AAAAAAAAA-8/oZUS1P2Ofog/s640/Amazon+Spot+price+AZ+-1.jpg" height="452"></a></div>  <span><br></span>  <b>Tip 4: Keep your Job logic small and store intermediate outputs in S3</b><br>  <span>Breakdown your complex processing logic into small jobs and design your jobs and tasks in EMR cluster in such a way that they run for very small period of time (example few minutes). Store all the intermediate job outputs in Amazon S3. This approach is helpful in EMR world and gives you following benefits:</span><br>  <br>  <ul>  <li><span>When your Core+ Task nodes are interrupted frequently, you can still continue from the intermediate points. Data accessed from S3.</span>  </li><li><span>You now have the flexibility to recreate the EMR clusters in multiple AZ depending upon the Spot price fluctuations</span>  </li><li><span>You can decide the number of nodes needed for your EMR cluster(even every hour) depending upon the data volume, density and velocity</span>  </li></ul>  <br>  <span>All the above 3 points when implemented contribute to elasticity in your architecture and there by helps you save costs in Amazon cloud. The above recommendation is not suitable for all Jobs, it has to be carefully mapped with right use cases by the architects.</span><br>  <br>  <span>To know more about real implementation of the above tips, read the following case study. <b><u><a href="http://harish11g.blogspot.in/2013/06/Amazon-Elastic-MapReduce-EMR-with-Spot-EC2-Cloud-Connect-Bigdata-presentation.html">Lock, Stock and X Smoking EC2's.</a></u></b>&nbsp;</span><br>  <span><br></span>  <span><b>Other Tips</b></span><br>  <span></span><br>  <span><a href="http://harish11g.blogspot.in/2013/04/Amazon-Web-Services-AWS-Cost-Saving-Tips-SQS-Long-polling-Batch-requests.html">Cost Saving Tip 1: Amazon SQS Long Polling and Batch requests</a></span><br>  <span><a href="http://harish11g.blogspot.in/2013/04/Amazon-Web-Services-AWS-Cost-Saving-Tips-Choosing-right-search-tier-Amazon-cloudsearch-Apache-Solr.html">Cost Saving Tip 2: How right search technology choice saves cost in AWS ?</a></span><br>  <span><a href="http://harish11g.blogspot.in/2013/04/Amazon-Web-Services-AWS-Cost-Saving-Tips-Amazon-Cloudfront-Price-class.html">Cost Saving Tip 3: Using Amazon CloudFront Price Class to minimize costs</a></span><br>  <span><a href="http://harish11g.blogspot.in/2013/04/Amazon-Web-Services-AWS-Cost-Saving-Tips-Amazon-ElastiCache-cluster-nodes.html">Cost Saving Tip 4 : Right Sizing Amazon ElastiCache Cluster</a></span><br>  <span><a href="http://harish11g.blogspot.in/2013/04/Amazon-Web-Services-AWS-Cost-Saving-Tips-how-Amazon-AutoScaling-can-reduce-leakage-save-costs.html">Cost Saving Tip 5: How Amazon Auto Scaling can save costs ?</a></span><br>  <span><a href="http://harish11g.blogspot.in/2013/04/Amazon-Web-Services-AWS-Cost-Saving-Tips-Amazon-AutoScaling-termination-policy-ClosestToNextInstanceHour.html">Cost Saving Tip 6: Amazon Auto Scaling Termination policy and savings</a></span><br>  <span><a href="http://harish11g.blogspot.in/2013/04/Amazon-Web-Services-AWS-Cost-Saving-Tips-Amazon-S3-Object-expiration.html">Cost Saving Tip 7: Use Amazon S3 Object Expiration</a></span><br>  <span><a href="http://harish11g.blogspot.in/2013/05/Amazon-Web-Services-AWS-Cost-Saving-Tips-Amazon-S3-Reduced-Redundancy-storage-rrs-vs-std.html">Cost Saving Tip 8: Use Amazon S3 Reduced Redundancy Storage</a>&nbsp;</span><span>&nbsp;</span><b><span>(new)</span></b><br>  <span><a href="http://harish11g.blogspot.in/2013/05/Amazon-Web-Services-AWS-Cost-Saving-Tips-Delete-Amazon-EBS-snapshots-regularly-retention-period.html">Cost Saving Tip 9: Have efficient EBS Snapshots Retention strategy in place</a></span><span>&nbsp;</span><b><span>(new)</span></b><br>  <span><a href="http://harish11g.blogspot.in/2013/05/Amazon-Web-Services-AWS-Cost-Saving-Tips-make-right-EBS-Volumes-Choice-PIOPS-vs-Standard.html">Cost Saving Top 10:&nbsp;Make right choice between PIOPS vs Std EBS volumes and save costs</a>&nbsp;<b><span>(new)</span></b></span><br>  <a href="http://harish11g.blogspot.in/2013/06/Amazon-Web-Services-AWS-Cost-Saving-Tips-elasticity-Amazon-Elastic-MapReduce-EMR.html">Cost Saving Top 11:&nbsp;<span><u>How elastic thinking saves cost in Amazon EMR Clusters ?</u></span>&nbsp;</a><b><span>(new)</span></b>  </div>  <br>  <div class="visit">  <a href="http://feedproxy.google.com/~r/CloudBigDataAndMobile/~3/2Qr94tWuyCs/Amazon-Web-Services-AWS-Cost-Saving-Tips-Adding-Spot-EC2-with-Amazon-Elastic-MapReduce-EMR.html">Visit website</a>  </div>  </div>  <div class="footer">  Sent via <a href="http://bit.ly/SA6Efh">feedly</a> // A news reader for creative minds.  </div>    </div>